select count(distinct id) from ods.ods_prism1_report_equity_change_info_df where pt = '20231105';
25416816

select count(distinct id) from ods.ods_prism1_report_shareholder_df where pt = '20231105';
427299910

select count(distinct id) from ods.ods_prism1_report_outbound_investment_df where pt = '20231105';
9824768

select count(distinct id) from ods.ods_prism1_report_webinfo_df where pt = '20231105';
12348964



select count(1) from (select id from ods.ods_prism1_report_shareholder_df where pt = '20231105' group by id)t;




----------------------------------------------

select count(1) from ads.ads_company_base_entity_annual_report_shareholder_equity_change_details where pt = '20231105';
15734348

select count(1) from ads.ads_company_base_entity_annual_report_shareholder_equity_details where pt = '20231105';
402803170

select count(1) from ads.ads_company_base_entity_annual_report_investment_details where pt = '20231105';
8477132

select count(1) from ads.ads_company_base_entity_annual_report_ebusiness_details where pt = '20231105';
10742074


add jar hdfs:///liang/bitmap.jar;
create temporary function to_bitmap as 'com.liang.hive.udf.ToBitmapUDAF';
create temporary function bitmap_count as 'com.liang.hive.udf.BitmapCountUDF';
set spark.driver.memory=2g;
set spark.driver.memoryOverhead=512m;
set spark.executor.memory=8g;
set spark.executor.memoryOverhead=512m;
set spark.memory.offHeap.enabled=true;
set spark.memory.offHeap.size=512m;
set spark.executor.cores=4;
set spark.debug.maxToStringFields=256;
set spark.memory.fraction=0.8;
set spark.serializer=org.apache.spark.serializer.KryoSerializer;

select
pt,
count(distinct id) cnt1,
count(distinct company_id) cnt2,
count(distinct shareholder_name_id) cnt3
from ads.ads_prism_shareholder_path_ratio_path_company
group by pt



select
pt,
count_distinct(id) cnt1,
count_distinct(company_id) cnt2,
count_distinct(shareholder_name_id) cnt3
from ads.ads_prism_shareholder_path_ratio_path_company
group by pt


select bitmap_count(to_bitmap(id)) from ads.ads_company_base_entity_annual_report_shareholder_equity_details where pt = '20231105';

