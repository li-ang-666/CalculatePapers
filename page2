
drop table hudi_ods.company_bond_plates;
drop table hudi_ods.company_equity_relation_details;
drop table hudi_ods.company_human_relation;
drop table hudi_ods.company_legal_person;
drop table hudi_ods.personnel;
drop table hudi_ods.senior_executive;
drop table hudi_ods.company_index;

set hive.input.format=org.apache.hadoop.hive.ql.io.HiveInputFormat;
select 'company_bond_plates' tb, count(1) cnt from hudi_ods.company_bond_plates
union all
select 'company_equity_relation_details' tb, count(1) cnt from hudi_ods.company_equity_relation_details
union all
select 'company_human_relation' tb, count(1) cnt from hudi_ods.company_human_relation
union all
select 'company_legal_person' tb, count(1) cnt from hudi_ods.company_legal_person
union all
select 'personnel' tb, count(1) cnt from hudi_ods.personnel
union all
select 'senior_executive' tb, count(1) cnt from hudi_ods.senior_executive
union all
select 'company_index' tb, count(1) cnt from hudi_ods.company_index;

drop table if exists hudi_ads.cooperation_partner;
create table if not exists hudi_ads.cooperation_partner(
  -- 老板
  boss_human_gid decimal(20, 0) comment '老板gid',
  boss_human_pid string comment '老板pid',
  boss_human_name string comment '老板名称',
  boss_identity string comment '老板身份',
  boss_shares decimal(20, 0) comment '老板持股(分)',
  -- 公司
  company_gid decimal(20, 0) comment '公司gid',
  company_name string comment '公司名称',
  company_registered_status string comment '公司经营状态',
  company_registered_capital decimal(20, 0) comment '公司注册资本(分)',
  s int comment '计算公式中的S, 公司为注吊销, 则为0, 否则为1',
  -- 伙伴
  partner_human_gid decimal(20, 0) comment '合作伙伴gid',
  partner_human_pid string comment '合作伙伴pid',
  partner_human_name string comment '合作伙伴名称',
  partner_identity string comment '合作伙伴身份',
  partner_shares decimal(20, 0) comment '合作伙伴持股(分)',
  -- 合作深度
  single_cooperation_score decimal(24, 4) comment '单次合作深度',
  multi_cooperation_score decimal(24, 4) comment '综合合作深度',
  single_cooperation_row_number int comment '单次合作深度排序',
  multi_cooperation_dense_rank int comment '综合合作深度排序',
  -- 补加
  cooperation_times_with_this_partner int comment '老板与该伙伴合作次数',
  cooperation_times_with_all_partner int comment '老板与所有伙伴合作次数',
  total_partners int comment '老板所有合作伙伴数'
)partitioned by (pt int comment 'yyyyMMdd');

drop table if exists company_base.cooperation_partner;
create table if not exists company_base.cooperation_partner(
  `id` bigint unsigned NOT NULL AUTO_INCREMENT COMMENT '主键id',
  -- 老板
  boss_human_gid bigint unsigned comment '老板gid',
  boss_human_pid varchar(50) comment '老板pid',
  boss_human_name varchar(255) comment '老板名称',
  boss_identity varchar(255) comment '老板身份',
  boss_shares bigint unsigned comment '老板持股(分)',
  -- 公司
  company_gid bigint unsigned comment '公司gid',
  company_name varchar(255) comment '公司名称',
  company_registered_status varchar(255) comment '公司经营状态',
  company_registered_capital bigint unsigned comment '公司注册资本(分)',
  s tinyint comment '计算公式中的S, 公司为注吊销, 则为0, 否则为1',
  -- 伙伴
  partner_human_gid bigint unsigned comment '合作伙伴gid',
  partner_human_pid varchar(50) comment '合作伙伴pid',
  partner_human_name varchar(255) comment '合作伙伴名称',
  partner_identity varchar(255) comment '合作伙伴身份',
  partner_shares bigint unsigned comment '合作伙伴持股(分)',
  -- 合作深度
  single_cooperation_score decimal(24, 4) comment '单次合作深度',
  multi_cooperation_score decimal(24, 4) comment '综合合作深度',
  single_cooperation_row_number int comment '单次合作深度排序',
  multi_cooperation_dense_rank int comment '综合合作深度排序',
  -- 补加
  cooperation_times_with_this_partner int comment '老板与该伙伴合作次数',
  cooperation_times_with_all_partner int comment '老板与所有伙伴合作次数',
  total_partners int comment '老板所有合作伙伴数',
  pt int comment 'yyyyMMdd',
  PRIMARY KEY (`id`),
  KEY `idx_list` (`boss_human_pid`,`single_cooperation_row_number`),
  KEY `idx_detail` (`boss_human_pid`,`partner_human_pid`)
);

nohup sh ./spark-submit.sh &
