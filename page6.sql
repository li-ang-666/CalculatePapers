0: jdbc:hive2://10.99.202.153:10000/> select * from origindb_company_base_shareholder_investment_relation_info_hi where pt = 20240704 limit 1;
INFO  : State: Compiling.
INFO  : Compiling command(queryId=omm_20240705143817_7961734c-1cc8-4fce-aaa7-2ed35ae54c4b): select * from origindb_company_base_shareholder_investment_relation_info_hi where pt = 20240704 limit 1; Current sessionId=27b15d59-0b3f-436f-ae0d-763fc70fecf3
INFO  : hive.compile.auto.avoid.cbo=true
INFO  : Insert table not follow columns
INFO  : Concurrency mode is disabled, not creating a lock manager
INFO  : Current sql is not contains insert syntax, not need record dest table flag
INFO  : Semantic Analysis Completed (retrial = false)
INFO  : Returning Hive schema: Schema(fieldSchemas:[FieldSchema(name:origindb_company_base_shareholder_investment_relation_info_hi.id, type:bigint, comment:null), FieldSchema(name:origindb_company_base_shareholder_investment_relation_info_hi.company_id, type:bigint, comment:null), FieldSchema(name:origindb_company_base_shareholder_investment_relation_info_hi.company_name, type:string, comment:null), FieldSchema(name:origindb_company_base_shareholder_investment_relation_info_hi.company_name_alias, type:string, comment:null), FieldSchema(name:origindb_company_base_shareholder_investment_relation_info_hi.shareholder_name_id, type:bigint, comment:null), FieldSchema(name:origindb_company_base_shareholder_investment_relation_info_hi.shareholder_name, type:string, comment:null), FieldSchema(name:origindb_company_base_shareholder_investment_relation_info_hi.shareholder_name_alias, type:string, comment:null), FieldSchema(name:origindb_company_base_shareholder_investment_relation_info_hi.shareholder_type, type:int, comment:null), FieldSchema(name:origindb_company_base_shareholder_investment_relation_info_hi.subscribed_capital, type:decimal(38,20), comment:null), FieldSchema(name:origindb_company_base_shareholder_investment_relation_info_hi.subscribed_capital_info, type:string, comment:null), FieldSchema(name:origindb_company_base_shareholder_investment_relation_info_hi.actual_capital_info, type:string, comment:null), FieldSchema(name:origindb_company_base_shareholder_investment_relation_info_hi.investment_ratio, type:decimal(24,12), comment:null), FieldSchema(name:origindb_company_base_shareholder_investment_relation_info_hi.data_source, type:int, comment:null), FieldSchema(name:origindb_company_base_shareholder_investment_relation_info_hi.create_time, type:string, comment:null), FieldSchema(name:origindb_company_base_shareholder_investment_relation_info_hi.update_time, type:string, comment:null), FieldSchema(name:origindb_company_base_shareholder_investment_relation_info_hi.partition_detail, type:int, comment:null), FieldSchema(name:origindb_company_base_shareholder_investment_relation_info_hi.offset_detail, type:bigint, comment:null), FieldSchema(name:origindb_company_base_shareholder_investment_relation_info_hi.timestamp_detail, type:bigint, comment:null), FieldSchema(name:origindb_company_base_shareholder_investment_relation_info_hi.before_column_list, type:string, comment:null), FieldSchema(name:origindb_company_base_shareholder_investment_relation_info_hi.dw_update_time, type:string, comment:null), FieldSchema(name:origindb_company_base_shareholder_investment_relation_info_hi.dw_is_del, type:int, comment:null), FieldSchema(name:origindb_company_base_shareholder_investment_relation_info_hi.dw_opt_type, type:string, comment:null), FieldSchema(name:origindb_company_base_shareholder_investment_relation_info_hi.investment_start_time, type:string, comment:null), FieldSchema(name:origindb_company_base_shareholder_investment_relation_info_hi.investment_change_type, type:string, comment:null), FieldSchema(name:origindb_company_base_shareholder_investment_relation_info_hi.investment_change_type_ratio, type:string, comment:null), FieldSchema(name:origindb_company_base_shareholder_investment_relation_info_hi.investment_change_type_amt, type:string, comment:null), FieldSchema(name:origindb_company_base_shareholder_investment_relation_info_hi.pt, type:string, comment:null), FieldSchema(name:origindb_company_base_shareholder_investment_relation_info_hi.hh, type:string, comment:null)], properties:null)
INFO  : Completed compiling command(queryId=omm_20240705143817_7961734c-1cc8-4fce-aaa7-2ed35ae54c4b); Time taken: 0.097 seconds
INFO  : Concurrency mode is disabled, not creating a lock manager
INFO  : State: Executing.
INFO  : Executing command(queryId=omm_20240705143817_7961734c-1cc8-4fce-aaa7-2ed35ae54c4b): select * from origindb_company_base_shareholder_investment_relation_info_hi where pt = 20240704 limit 1; Current sessionId=27b15d59-0b3f-436f-ae0d-763fc70fecf3
INFO  : Completed executing command(queryId=omm_20240705143817_7961734c-1cc8-4fce-aaa7-2ed35ae54c4b); Time taken: 0.001 seconds
INFO  : OK
INFO  : Concurrency mode is disabled, not creating a lock manager
+-------------------------------------------------------------------+---------------------------------------------------------------------------+-----------------------------------------------------------------------------+-----------------------------------------------------------------------------------+------------------------------------------------------------------------------------+---------------------------------------------------------------------------------+---------------------------------------------------------------------------------------+---------------------------------------------------------------------------------+-----------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+------------------------------------------------------------------------------------+---------------------------------------------------------------------------------+----------------------------------------------------------------------------+----------------------------------------------------------------------------+----------------------------------------------------------------------------+---------------------------------------------------------------------------------+------------------------------------------------------------------------------+---------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------+--------------------------------------------------------------------------+----------------------------------------------------------------------------+--------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------+-------------------------------------------------------------------+-------------------------------------------------------------------+
| origindb_company_base_shareholder_investment_relation_info_hi.id  | origindb_company_base_shareholder_investment_relation_info_hi.company_id  | origindb_company_base_shareholder_investment_relation_info_hi.company_name  | origindb_company_base_shareholder_investment_relation_info_hi.company_name_alias  | origindb_company_base_shareholder_investment_relation_info_hi.shareholder_name_id  | origindb_company_base_shareholder_investment_relation_info_hi.shareholder_name  | origindb_company_base_shareholder_investment_relation_info_hi.shareholder_name_alias  | origindb_company_base_shareholder_investment_relation_info_hi.shareholder_type  | origindb_company_base_shareholder_investment_relation_info_hi.subscribed_capital  | origindb_company_base_shareholder_investment_relation_info_hi.subscribed_capital_info  | origindb_company_base_shareholder_investment_relation_info_hi.actual_capital_info  | origindb_company_base_shareholder_investment_relation_info_hi.investment_ratio  | origindb_company_base_shareholder_investment_relation_info_hi.data_source  | origindb_company_base_shareholder_investment_relation_info_hi.create_time  | origindb_company_base_shareholder_investment_relation_info_hi.update_time  | origindb_company_base_shareholder_investment_relation_info_hi.partition_detail  | origindb_company_base_shareholder_investment_relation_info_hi.offset_detail  | origindb_company_base_shareholder_investment_relation_info_hi.timestamp_detail  |                                                                                                                                                                                                                   origindb_company_base_shareholder_investment_relation_info_hi.before_column_list                                                                                                                                                                                                                   | origindb_company_base_shareholder_investment_relation_info_hi.dw_update_time  | origindb_company_base_shareholder_investment_relation_info_hi.dw_is_del  | origindb_company_base_shareholder_investment_relation_info_hi.dw_opt_type  | origindb_company_base_shareholder_investment_relation_info_hi.investment_start_time  | origindb_company_base_shareholder_investment_relation_info_hi.investment_change_type  | origindb_company_base_shareholder_investment_relation_info_hi.investment_change_type_ratio  | origindb_company_base_shareholder_investment_relation_info_hi.investment_change_type_amt  | origindb_company_base_shareholder_investment_relation_info_hi.pt  | origindb_company_base_shareholder_investment_relation_info_hi.hh  |
+-------------------------------------------------------------------+---------------------------------------------------------------------------+-----------------------------------------------------------------------------+-----------------------------------------------------------------------------------+------------------------------------------------------------------------------------+---------------------------------------------------------------------------------+---------------------------------------------------------------------------------------+---------------------------------------------------------------------------------+-----------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+------------------------------------------------------------------------------------+---------------------------------------------------------------------------------+----------------------------------------------------------------------------+----------------------------------------------------------------------------+----------------------------------------------------------------------------+---------------------------------------------------------------------------------+------------------------------------------------------------------------------+---------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------+--------------------------------------------------------------------------+----------------------------------------------------------------------------+--------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------+-------------------------------------------------------------------+-------------------------------------------------------------------+
| 10009090363429064                                                 | 5629573509                                                                | 武汉诺顿科技有限公司                                                        |                                                                                   | 2176582746                                                                         | 谢杰                                                                            |                                                                                       | 1                                                                               | 200.00000000000000000000                                                          | [{"amomon": "200.0万元人民币", "paymet": "货币", "time": "2042-07-25"}]                | []                                                                                 | 1.000000000000                                                                  | 0                                                                          | 2022-07-28 22:06:04                                                        | 2024-02-16 00:08:41                                                        | 0                                                                               | 66222867                                                                     | 1720022401001                                                                   | {"investment_start_time":"2022-07-26","company_id":"5629573509","create_time":"2022-07-28 22:06:04","shareholder_type":"1","shareholder_type_show":"6","subscribed_capital":"200.000000000000000000","subscribed_capital_info":"[{\"amomon\": \"200.0万元人民币\", \"paymet\": \"货币\", \"time\": \"2042-07-25\"}]","actual_capital_info":"[]","data_source":"0","company_name_alias":"","investment_change_type":"4","investment_change_type_ratio":"1","update_time":"2024-02-16 00:08:41","share_type":"","company_name":"武汉诺顿科技有限公司","investment_change_type_amt":"1","id":"10009090363429064","shareholder_nationality":"","shareholder_name_id":"2176582746","shareholder_name":"谢杰","shareholder_name_alias":"","investment_ratio":"1.000000000"} | 2024-07-04 00:00:01.001                                                       | 1                                                                        | DELETE                                                                     | 2022-07-26                                                                           | 4                                                                                     | 1                                                                                           | 1                                                                                         | 20240704                                                          | 23                                                                |
+-------------------------------------------------------------------+---------------------------------------------------------------------------+-----------------------------------------------------------------------------+-----------------------------------------------------------------------------------+------------------------------------------------------------------------------------+---------------------------------------------------------------------------------+---------------------------------------------------------------------------------------+---------------------------------------------------------------------------------+-----------------------------------------------------------------------------------+----------------------------------------------------------------------------------------+------------------------------------------------------------------------------------+---------------------------------------------------------------------------------+----------------------------------------------------------------------------+----------------------------------------------------------------------------+----------------------------------------------------------------------------+---------------------------------------------------------------------------------+------------------------------------------------------------------------------+---------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------+--------------------------------------------------------------------------+----------------------------------------------------------------------------+--------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------+-------------------------------------------------------------------+-------------------------------------------------------------------+
1 row selected (0.875 seconds)
0: jdbc:hive2://10.99.202.153:10000/> select count(distinct company_id) from origindb_company_base_shareholder_investment_relation_info_hi where pt = 20240704 and 

with
company_ids as(
  select distinct company_id
  from origindb_offline.origindb_company_base_shareholder_investment_relation_info_hi
  where pt = 20240704
  and from_unixtime(cast(timestamp_detail/1000 as int),'yyyy-MM-dd HH:mm:ss')
  between '2024-07-04 11:00:00' and '2024-07-04 14:30:00'
),
equity_ratio as(
    select * from ods.ods_prism1_equity_ratio_df
    where pt = 20240704
)
select count(1) from equity_ratio left semi join company_ids on equity_ratio.company_graph_id = company_ids.company_id


ratio_path_company as(
    select * from ods.ods_prism_shareholder_path_ratio_path_company_new_all_df
    where pt = 20240707
),
invested_company_ids as(
  select distinct ratio_path_company.company_id company_id
  from ratio_path_company
  join company_ids
  on ratio_path_company.shareholder_name_id = company_ids.company_id
),all_company_ids as(
    select company_id from company_ids
    union all
    select company_id from invested_company_ids
)
select count(1) from ratio_path_company
  join all_company_ids
  on ratio_path_company.company_id = all_company_ids.company_id;


Struct{
    before=Struct{id=7,name=a},
    after=Struct{id=7,name=b},
    source=Struct{version=1.9.7.Final,connector=mysql,name=mysql_binlog_source,ts_ms=1720440978000,db=test,table=test,server_id=4135649407,gtid=3c56f65d-8baa-11ed-8018-fa163e45af81:397578417,file=mysql-bin.192840,pos=6967594,row=0,thread=242553884},
    op=u,
    ts_ms=1720441657433
}

  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',

