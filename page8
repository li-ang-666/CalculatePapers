CREATE TABLE source_table(
  id                         DECIMAL(20, 0),
  company_id                 BIGINT,
  shareholder_id             STRING,
  shareholder_entity_type    SMALLINT,
  shareholder_name_id        BIGINT,
  investment_ratio_total     DECIMAL(24, 12),
  is_controller              SMALLINT,
  is_ultimate                SMALLINT,
  is_big_shareholder         SMALLINT,
  is_controlling_shareholder SMALLINT,
  equity_holding_path        STRING,
  create_time                TIMESTAMP(0),
  update_time                TIMESTAMP(0),
  is_deleted                 SMALLINT,
  op_ts as CAST(NOW() AS TIMESTAMP(0)),
  PRIMARY KEY (id) NOT ENFORCED
) WITH (
  'connector' = 'jdbc',
  'url' = 'jdbc:mysql://10.99.131.246:3306/company_base',
  'table-name' = 'ratio_path_company',
  'username' = 'jdhw_d_data_dml',
  'password' = '2s0^tFa4SLrp72',
  'scan.partition.column' = 'id',
  'scan.partition.num' = '40000',
  'scan.partition.lower-bound' = '1',
  'scan.partition.upper-bound' = '400000000',
  'scan.fetch-size' = '1024'
);
create table ratio_path_company(
  id                         DECIMAL(20, 0),
  company_id                 BIGINT,
  shareholder_id             STRING,
  shareholder_entity_type    SMALLINT,
  shareholder_name_id        BIGINT,
  investment_ratio_total     DECIMAL(24, 12),
  is_controller              SMALLINT,
  is_ultimate                SMALLINT,
  is_big_shareholder         SMALLINT,
  is_controlling_shareholder SMALLINT,
  equity_holding_path        STRING,
  create_time                TIMESTAMP(0),
  update_time                TIMESTAMP(0),
  is_deleted                 SMALLINT,
  op_ts                      TIMESTAMP(0),
  PRIMARY KEY (id) NOT ENFORCED
) WITH (
  'connector' = 'hudi',
  'path' = 'obs://hadoop-obs/ods_hudi/ratio_path_company018',
  'table.type' = 'MERGE_ON_READ',
  -- index
  'index.type' = 'BUCKET',
  'hoodie.bucket.index.num.buckets' = '256',
  -- write
  'write.operation' = 'bulk_insert',
  'write.bulk_insert.shuffle_input' = 'false',
  'write.bulk_insert.sort_input' = 'false',
  'write.tasks' = '128'
);
insert into ratio_path_company select cast(id as DECIMAL(20, 0)) id,cast(company_id as BIGINT) company_id,cast(shareholder_id as STRING) shareholder_id,cast(shareholder_entity_type as SMALLINT) shareholder_entity_type,cast(shareholder_name_id as BIGINT) shareholder_name_id,cast(investment_ratio_total as DECIMAL(24, 12)) investment_ratio_total,cast(is_controller as SMALLINT) is_controller,cast(is_ultimate as SMALLINT) is_ultimate,cast(is_big_shareholder as SMALLINT) is_big_shareholder,cast(is_controlling_shareholder as SMALLINT) is_controlling_shareholder,cast(equity_holding_path as STRING) equity_holding_path,cast(create_time as TIMESTAMP(0)) create_time,cast(update_time as TIMESTAMP(0)) update_time,cast(is_deleted as SMALLINT) is_deleted,cast(op_ts as TIMESTAMP(0)) op_ts from source_table;