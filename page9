CREATE TABLE ods(
  id                                                  DECIMAL(20, 0),
  tyc_unique_entity_id                                STRING,
  entity_type_id                                      TINYINT,
  entity_name_valid                                   STRING,
  entity_type_id_with_shareholder_identity_type       TINYINT,
  tyc_unique_entity_id_with_shareholder_identity_type STRING,
  entity_name_valid_with_shareholder_identity_type    STRING,
  shareholder_identity_type                           TINYINT,
  equity_ratio_path_cnt                               BIGINT,
  estimated_equity_ratio_total                        DECIMAL(24,12),
  shareholder_validation_time_year                    BIGINT,
  create_time                                         TIMESTAMP(3),
  update_time                                         TIMESTAMP(3),
  op_ts as CAST(CURRENT_TIMESTAMP AS TIMESTAMP(3)),
  PRIMARY KEY (id) NOT ENFORCED
) WITH (
  'connector' = 'jdbc',
  'url' = 'jdbc:mysql://48e2e76353e546a7b86c81dd226af952in01.internal.cn-north-4.mysql.rds.myhuaweicloud.com/bdp_equity',
  'table-name' = 'shareholder_identity_type_details',
  'username' = 'jdhw_d_data_dml',
  'password' = '2s0^tFa4SLrp72',
  'scan.partition.column' = 'id',
  'scan.partition.lower-bound' = '1',
  'scan.partition.upper-bound' = '102400000',
  'scan.partition.num' = '10000',
  'scan.fetch-size' = '2048'
);
create table dwd(
  id                                                  DECIMAL(20, 0),
  tyc_unique_entity_id                                STRING,
  entity_type_id                                      TINYINT,
  entity_name_valid                                   STRING,
  entity_type_id_with_shareholder_identity_type       TINYINT,
  tyc_unique_entity_id_with_shareholder_identity_type STRING,
  entity_name_valid_with_shareholder_identity_type    STRING,
  shareholder_identity_type                           TINYINT,
  equity_ratio_path_cnt                               BIGINT,
  estimated_equity_ratio_total                        DECIMAL(24,12),
  shareholder_validation_time_year                    BIGINT,
  create_time                                         TIMESTAMP(3),
  update_time                                         TIMESTAMP(3),
  op_ts                      TIMESTAMP(3),
  PRIMARY KEY (id) NOT ENFORCED
) WITH (
  'connector' = 'hudi',
  'path' = 'obs://hadoop-obs/hudi_ods/shareholder_identity_type_details',
  'table.type' = 'MERGE_ON_READ',
  -- index
  'index.type' = 'BUCKET',
  'hoodie.bucket.index.num.buckets' = '128',
  -- write
  'write.operation' = 'bulk_insert',
  'write.bulk_insert.shuffle_input' = 'false',
  'write.bulk_insert.sort_input' = 'false',
  'write.tasks' = '64',
  'write.precombine' = 'true',
  'write.precombine.field' = 'op_ts',
  -- compaction
  'compaction.schedule.enabled' = 'false',
  'compaction.async.enabled' = 'false',
  -- clean
  'clean.async.enabled' = 'false',
  -- hive
  'hive_sync.enabled' = 'true',
  'hive_sync.db' = 'hudi_ods',
  'hive_sync.table' = 'shareholder_identity_type_details',
  'hive_sync.metastore.uris' = 'thrift://10.99.202.153:9083',
  'hive_sync.mode' = 'hms',
  'hive_sync.skip_ro_suffix' = 'true'
);
insert into dwd select
id,tyc_unique_entity_id,entity_type_id,entity_name_valid,entity_type_id_with_shareholder_identity_type,tyc_unique_entity_id_with_shareholder_identity_type,entity_name_valid_with_shareholder_identity_type,shareholder_identity_type,equity_ratio_path_cnt,estimated_equity_ratio_total,shareholder_validation_time_year,CAST(CONVERT_TZ(CAST(create_time AS STRING), 'Asia/Shanghai', 'UTC') AS TIMESTAMP(3)) create_time,CAST(CONVERT_TZ(CAST(update_time AS STRING), 'Asia/Shanghai', 'UTC') AS TIMESTAMP(3)) update_time,CAST(CONVERT_TZ(CAST(op_ts AS STRING), 'Asia/Shanghai', 'UTC') AS TIMESTAMP(3)) op_ts
from ods