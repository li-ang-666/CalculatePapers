select
  1 as entity_type,
  concat ('', ifnull (company_id, 0)) as tyc_unique_entity_id,
  ifnull (company_id, 0) as entity_name_id,
  shareholder_entity_type,
  shareholder_id,
  shareholder_name_id,
  shareholder_identity_type,
  create_time,
  update_time
from
  (
    select
      *,
      ifnull ('实际控制人', '') as shareholder_identity_type
    from
      ratio_path_company
    where
      company_id in <if test = "entity_name_ids != null"> <foreach collection = "entity_name_ids" separator = "," close = ")" open = "(" item = "value"> #{value} </foreach> </if>
      and is_controller = 1
    union all
    select
      *,
      ifnull ('受益所有人', '') as shareholder_identity_type
    from
      ratio_path_company
    where
      company_id in <if test = "entity_name_ids != null"> <foreach collection = "entity_name_ids" separator = "," close = ")" open = "(" item = "value"> #{value} </foreach> </if>
      and is_ultimate = 1
    union all
    select
      *,
      ifnull ('大股东', '') as shareholder_identity_type
    from
      ratio_path_company
    where
      company_id in <if test = "entity_name_ids != null"> <foreach collection = "entity_name_ids" separator = "," close = ")" open = "(" item = "value"> #{value} </foreach> </if>
      and is_big_shareholder = 1
    union all
    select
      *,
      ifnull ('控股股东', '') as shareholder_identity_type
    from
      ratio_path_company
    where
      company_id in <if test = "entity_name_ids != null"> <foreach collection = "entity_name_ids" separator = "," close = ")" open = "(" item = "value"> #{value} </foreach> </if>
      and is_controlling_shareholder = 1
  ) a
order by
  company_id,
  shareholder_identity_type <if test = "limit!=null and offset!=null">
limit
  #{offset}, #{limit} </if>